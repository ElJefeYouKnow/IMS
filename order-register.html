<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Procurement &amp; Allocation</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body data-ds="pro">
  <div class="app">
        <aside class="sidebar">
      <div>
        <div class="brand">Inventory Management System</div>
        <div class="subtitle">by Modulr</div>
        <div class="user-chip">
          <div class="avatar">US</div>
          <div>
            <div style="font-weight:700;">User</div>
            <div style="font-size:12px;opacity:0.8;"></div>
          </div>
        </div>
      </div>
                  <nav>
        <a  href="dashboard.html" data-role="admin">Dashboard</a>
        <a  href="employee-dashboard.html" data-role="employee">Dashboard</a>
        <a href="inventory-operations.html">Operations</a>
        <a href="field-purchase.html" >Field Purchases</a>
        <a href="inventory-list.html">Inventory</a>
        <a href="item-master.html" data-role="admin">Item Master</a>
        <a href="job-creator.html" data-role="admin">Project Manager</a>
        <a class="active" href="order-register.html" data-role="admin">Procurement &amp; Allocation</a>
        <a href="analytics.html" data-role="admin">Analytics</a>
        <a href="settings.html" data-role="admin">Settings</a>
        <a href="settings-employee.html" data-role="employee">Settings</a>
        <a href="support.html">Support</a>
      </nav>
  </aside>

    <main class="main">
      <header class="topbar">
        <h1>Procurement &amp; Allocation</h1>
        <div class="topbar-right"><button id="logoutBtn" class="muted">Logout</button></div>
      </header>

      <section class="card" style="margin-bottom:12px;position:sticky;top:0;z-index:5;">
        <div class="mode-tabs">
          <button class="mode-btn active" data-mode="order">Procurement</button>
          <button class="mode-btn" data-mode="reserve">Allocation</button>
        </div>
      </section>

      <div id="order-mode" class="mode-content active">
        <div class="page-grid">
          <section class="card inventory-card">
            <p class="muted-text">Admin-only: log items that have been ordered but not yet received.</p>
            <form id="orderForm" class="inventory-form" autocomplete="off">
              <div class="form-row">
                <label>Default Project
                  <select id="orderJob">
                    <option value="">General Inventory</option>
                  </select>
                </label>
                <label class="toggle-inline">
                  <input type="checkbox" id="order-apply-default" checked> Apply default to all lines
                </label>
                <label class="toggle-inline">
                  <input type="checkbox" id="order-stick-job"> Keep last project
                </label>
                <label class="toggle-inline">
                  <input type="checkbox" id="order-auto-reserve" checked> Auto-reserve on receive
                </label>
              </div>
              <div class="form-row">
                <label>Default ETA<input id="orderEta" type="date" class="eta-input"></label>
              </div>
              

              <div class="order-lines-header">
                <strong>Order Lines</strong>
                <button id="order-addLine" type="button" class="muted">Add Line</button>
              </div>
              <div id="order-lines" class="line-items"></div>

              <div class="form-row bulk-box">
                <label style="flex:1">Quick bulk paste (code,name,qty,eta,project)
                  <textarea id="order-bulk" rows="3" placeholder="ABC123,Widgets,2,2025-01-10,JOB-1&#10;XYZ9,,5,2025-01-11,"></textarea>
                </label>
                <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-start;">
                  <button id="order-bulk-load" type="button" class="muted" style="margin-top:22px;">Load to lines</button>
                  <button id="order-bulk-apply" type="button" class="muted">Submit bulk</button>
                  <button id="order-bulk-clear" type="button" class="muted">Clear bulk</button>
                </div>
              </div>

              <div class="form-row">
                <label style="flex:1">Notes<textarea id="orderNotes" rows="2" placeholder="Optional notes for all lines"></textarea></label>
              </div>
              <div class="form-row sticky-actions-mobile">
                <button id="orderSubmitBtn" type="submit">Review &amp; Submit</button>
                <button id="orderSubmitAnother" type="button" class="muted">Submit &amp; Add More</button>
                <button id="orderClearBtn" type="button" class="muted">Clear</button>
              </div>
              <div id="orderMsg" style="font-size:0.9rem;"></div>
            </form>
          </section>

          <section class="card">
            <h3>Incoming Summary</h3>
            <div class="summary-grid">
              <div class="summary-item">
                <span>Open Units</span>
                <strong id="orderSummaryCount">-</strong>
              </div>
              <div class="summary-item">
                <span>Overdue</span>
                <strong id="orderSummaryLate">-</strong>
              </div>
              <div class="summary-item">
                <span>Next ETA</span>
                <strong id="orderSummaryNext">-</strong>
              </div>
            </div>
            <div class="summary-list">
              <strong>Top Incoming Items</strong>
              <div id="orderSummaryTop" class="summary-items"></div>
            </div>
            <div class="summary-list">
              <strong>Upcoming by ETA</strong>
              <div id="orderSummaryEta" class="summary-items"></div>
            </div>
          </section>

          <section class="card">
            <div class="data-toolbar">
              <input id="orderFilter" placeholder="Filter by project/code" />
              <div class="filter-chips">
                <button class="filter-btn active" data-range="all" type="button">All</button>
                <button class="filter-btn" data-range="today" type="button">Today</button>
                <button class="filter-btn" data-range="week" type="button">This Week</button>
                <button class="filter-btn" data-range="late" type="button">Late</button>
              </div>
              <span class="badge info">Inbound</span>
            </div>
            <h3>Recently Registered Orders</h3>
            <table id="recentOrdersTable">
              <thead><tr><th>Code</th><th>Name</th><th>Open Qty</th><th>Project</th><th>ETA</th><th>When</th></tr></thead>
              <tbody></tbody>
            </table>
          </section>
        </div>
      </div>

      <div id="reserve-mode" class="mode-content">
        <div class="page-grid">
          <section class="card inventory-card">
            <p class="muted-text">Admin-only: allocate stock to a job (removes from available until released).</p>
            <form id="reserveForm" class="inventory-form" autocomplete="off">
              <div>
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
                  <strong>Line Items</strong>
                  <button id="reserve-addLine" type="button" class="muted">Add Line</button>
                </div>
                <div id="reserve-lines" class="line-items"></div>
              </div>
              <div class="form-row">
                <label>Project Name/ID
                  <select id="reserve-jobId" required>
                    <option value="">Select project...</option>
                  </select>
                </label>
              </div>
              <div class="form-row">
                <label>Expected Return Date<input id="reserve-returnDate" type="date"></label>
              </div>
              <div class="form-row">
                <label style="flex:1">Notes<textarea id="reserve-notes" rows="2" placeholder="Optional notes"></textarea></label>
              </div>
              <div class="form-row sticky-actions-mobile">
                <button id="reserveBtn" type="submit">Reserve</button>
                <button id="reserve-clearBtn" type="button" class="muted">Clear</button>
              </div>
              <div id="reserveMsg" style="font-size:0.9rem;"></div>
            </form>
          </section>

          <section class="card">
            <div class="data-toolbar">
              <input id="reserveFilter" placeholder="Filter by job/code" />
              <span class="badge warn">Reserved</span>
            </div>
            <h3>Active Project Reservations</h3>
            <table id="reserveTable">
              <thead><tr><th>Code</th><th>Project</th><th>Qty</th><th class="mobile-hide">Expected Return</th><th class="mobile-hide">Reserved On</th></tr></thead>
              <tbody></tbody>
            </table>
          </section>

          <section class="card">
            <h3>Reassign Reserved Stock</h3>
            <p class="muted" style="margin-top:-2px;">Move reserved stock between projects or back to general inventory.</p>
            <form id="reassignForm" class="inventory-form" autocomplete="off">
              <div class="form-row">
                <label class="with-suggest">Item Code
                  <input id="reassign-code" placeholder="SKU/part" required list="order-sku-options">
                  <div id="reassign-code-s" class="suggestions"></div>
                </label>
                <label>From Project
                  <select id="reassign-from" required>
                    <option value="">Select project...</option>
                  </select>
                </label>
              </div>
              <div class="form-row">
                <label>To Project (optional)
                  <select id="reassign-to">
                    <option value="">General Inventory</option>
                  </select>
                </label>
                <label style="max-width:140px;">Qty<input id="reassign-qty" type="number" min="1" value="1" required></label>
              </div>
              <div class="form-row">
                <label style="flex:1">Reason<textarea id="reassign-reason" rows="2" required placeholder="Why are you reassigning?"></textarea></label>
              </div>
              <div class="form-row sticky-actions-mobile">
                <button id="reassignBtn" type="submit">Reassign</button>
                <button id="reassign-clearBtn" type="button" class="muted">Clear</button>
              </div>
              <div id="reassignMsg" style="font-size:0.9rem;"></div>
            </form>
          </section>

          <section class="card">
            <h3>Bulk Reserve (paste)</h3>
            <p class="muted" style="margin-top:-2px;">Format: code,qty per line. Uses selected job above.</p>
            <div class="form-row bulk-box">
              <label style="flex:1">Lines
                <textarea id="reserve-bulk" rows="3" placeholder="ABC123,2&#10;XYZ9,5"></textarea>
              </label>
              <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-start;">
                <button id="reserve-bulk-load" type="button" class="muted" style="margin-top:22px;">Load to lines</button>
                <button id="reserve-bulk-apply" type="button" class="muted">Reserve bulk</button>
                <button id="reserve-bulk-clear" type="button" class="muted">Clear bulk</button>
              </div>
            </div>
          </section>
        </div>
      </div>
    </main>
  </div>
  <datalist id="order-sku-options"></datalist>
  <datalist id="reserve-sku-options"></datalist>

  <div id="orderReviewModal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-content">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <h3 style="margin:0;">Review Orders</h3>
        <button id="orderReviewClose" class="muted" type="button">Close</button>
      </div>
      <p class="muted-text" id="orderReviewSummary">-</p>
      <table id="orderReviewTable">
        <thead><tr><th>Code</th><th>Name</th><th>Qty</th><th>ETA</th><th>Project</th></tr></thead>
        <tbody></tbody>
      </table>
      <div class="modal-actions">
        <button id="orderReviewConfirm" type="button">Confirm</button>
        <button id="orderReviewCancel" type="button" class="muted">Cancel</button>
      </div>
    </div>
  </div>

  <script src="js/utils.js"></script>
  <script src="js/order-register.js"></script>
  <script>document.addEventListener('DOMContentLoaded',()=>{if(window.utils){utils.wrapFetchWithRole?.();utils.applyStoredTheme?.();utils.applyNavVisibility?.();utils.setupLogout?.();}});</script>
</body>
</html>






